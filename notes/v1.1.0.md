# Changelog

## Breaking changes

### Removed `AsList` workaround for `deptemplateapi`

As the bug with the `GET deployments/template/{template_id}` endpoint for
ESS users has been fixed, we no longer need to use the AsList field when
calling it.

## Notable changes
<!-- Add the list of notable changes, remove otherwise.-->

### New APIs

#### Traffic filtering APIs

The CRUD and association traffic filtering APIs have been
implemented. They can be found in the new `trafficfilterapi`
package.

#### Reset Elasticsearch password

The new `ResetElasticsearchPassword` API resets a deployment's
Elasticsearch password and returns the username and password. This new
API can be found within the `depresourceapi` package.

#### Elasticsearch remote clusters APIs

Both `Get()` and `Update()` APIs have been added for the remote
clusters APIs, which power ESS Cross Cluster Search assignments.

#### Deployment migrate API

Added a new `Migrate()` API to the `deploymentapi` package.
This new API returns a deployment update request that would
transform this deployment from its template to the provided one.

### Changes to existing APIs

#### JSON formatted errors for vacate APIs

Introduces a series of changes which allow `allocator.Vacate()` to
return a multierror which can serialize the errors to JSON format.

To do so, multiple changes have been made throughout multiple packages,
providing building blocks for other APIs to leverage these, or use on-
demand.

`multierror.WithFormat()`: modifies a `multierror.Prefixed` or Hashicorp
`multierror.Error` format functions which instead of formatting with a
"text" format, return a JSON formatted string.

`apierror.JSONError{}`: wrapping any string with this type, will make
it compatible to `json.Marshal`-ed. A `apierror.NewJSONError()` function
is provided for convenience too, allowing errors to be wrapped in the type.

`plan.StreamJSON`: has been fixed to return the final error result in
JSON formatted form.

`plan`: Legacy format has now been removed since it's no longer used.

`allocatorapi.VacateError`: now used for most of the returned vacate
errors since it supports both text and JSON formats.

#### New field for parameters struct in `allocatorapi`

A new `Size` parameter has been added to `ListParams` in the`allocatorapi`
package, which allows users to obtain more than the default 100 allocator size.

#### Legacy plan conversion

A new optional boolean to `deploymentapi.Get()` which allows users
to optionally convert the legacy plan format to the current format.

#### Fail fast parameter for the sync/pool package

New `FailFast` parameter to `pool.Params` which allows consumers to
toggle a new pool behavior where the pool will gracefully stop when one of
the workers returns with an error. This will stop processing any additional
work but try to continue processing the work that's in-flight or cancel the
execution when the `params.Timeout.Stop` `time.Duration` is exceeded.

#### New CustomTransport unifying RoundTripper(s)

Added a new implementation of `http.RoundTripper` which aims to unify all
existing segregated RoundTrippers which have been marked as deprecated.

Additionally, adding support to configurable retries on request timeout
through two new `api.Config` fields: `Retries` and `RetryBackoff`.

To keep backwards compatibility, the retries are opt-in even though they
would improve the resilience of the SDK. They can always be made opt-out
in the future if we deem it necessary.

### Detailed changes
<!-- AUTOGENERATED COMMIT LIST -->

* 84da41c deploymentapi: New Migrate API for the deployment migrate endpoint (#242)
* 5d1859d deptemplateapi: Remove workaround for the deployment template get API (#241)
* 15cf01d deps: update apidocs to 2.7.0-ms47 (#239)
* 82f507e chore(deps): update module fatih/color to v1.10.0 (#240)
* fc45532 chore(deps): update go-openapi packages (#238)
* 6271dcf godoc: Improve the pkg/api documentation (#237)
* 4126802 chore(deps): update go-openapi packages (#236)
* 171d06d api: Correct all timeout values for retries (#235)
* 087522c chore(deps): update actions/setup-go action to v2 (#234)
* dbdc850 chore(deps): update actions/checkout action to v2 (#233)
* aab3d3e chore(deps): update actions/cache action to v2 (#232)
* 13f03d9 http: Retry on net.Error.Timeout() == true (#231)
* cd6137f chore(deps): update go-openapi packages (#230)
* 9bf7939 transport: Fix retries logic when enabled (#228)
* cbe04a0 chore(deps): update module spf13/cobra to v1.1.1 (#229)
* b355a49 esremoteclustersapi: Add Get and Update functions (#227)
* 75adab0 chore(deps): update module spf13/cobra to v1.1.0 (#225)
* 0a671aa transport: Adds another patch to unwrap the error (#226)
* cc989e6 chore(deps): update module go-openapi/strfmt to v0.19.6 (#223)
* 6fc0976 allocatorapi: Fix incorrect json error formatting (#222)
* 1840b0b api: Add CustomTransport unifying RoundTripper(s) (#220)
* 20bba40 apivalidation: Set workflow to Go 1.14 (#218)
* fc4e5b0 actions: Add scheduled api-validation job (#217)
* 77b2092 sync/pool: Add FailFast parameter, stopping on err (#216)
* 02b25ee Add latest apidocs.json after ms-46 update (#215)
* 3562493 chore(deps): update module go-openapi/runtime to v0.19.22 (#214)
* d7edeef chore(deps): update go-openapi packages (#213)
* f64aee7 notes: Update changelog gen and add v1.0.1 log (#212)
* 2263d5a go: Update to go 1.15 (#211)
* c1fb5ed deploymentapi: Add ConvertLegacyPlans to Get (#209)
* ca3be2f depresourceapi: Add Reset elasticsearch password (#206)
* fda3aed allocatorapi: Add ListParams field comments (#207)
* 47c25dd chore(deps): update github.com/asaskevich/govalidator commit hash to 7a23bdc (#208)
* 9b118e6 allocatorapi: Add Size parameter to ListParams (#205)
* 9b1e215 error: Add JSON formatted errors for vacate APIs (#186)
* 92c4226 trafficfilterapi: Add CRUD and association APIs (#204)
* 87ce727 swagger: Update definition to MS45 spec (#203)
* ef73f71 Update semver import path (#201)
* 32d7e33 api: Add missing Create response on traffic rule assoc (#200)
* 5541437 deploymentapi: Add CreateParams struct comments (#187)
* 34b564b swagger: Update cmd to v0.25.0 (#199)
* 3f2ae71 Update versions (#188)
* 1ec3bd8 chore(deps): update module blang/semver to v4 (#197)
* d2af965 chore(deps): update module spf13/cobra to v1 (#198)
* 94cfc9f chore(deps): update golang docker tag to v1.14 (#193)
* 4bb3520 chore(deps): update module mitchellh/mapstructure to v1.3.3 (#196)
* dae0695 chore(deps): update module hashicorp/go-multierror to v1.1.0 (#195)
* 3316b15 chore(deps): update github.com/asaskevich/govalidator commit hash to 29e1ff8 (#191)
* 9f6e4fb chore(deps): update go-openapi packages (#192)
* 31b8002 deps: Enable Renovate (#189)
